<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoteGenie2 - AI Study Notes Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header Styles */
        .header {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #e0e0e0;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .header h1 i {
            color: #4a9eff;
            margin-right: 0.5rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            background: linear-gradient(135deg, #4a9eff 0%, #357abd 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 158, 255, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #4a9eff;
            color: #4a9eff;
        }

        .btn-outline:hover {
            background: #4a9eff;
            color: white;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-welcome {
            color: #a0a0a0;
            font-size: 0.9rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            width: 100%;
        }

        /* Auth Forms */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 60vh;
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 2rem;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.05);
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            background: transparent;
            border: none;
            color: #a0a0a0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            background: #4a9eff;
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #e0e0e0;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: #e0e0e0;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: #4a9eff;
            box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.1);
        }

        .btn-full {
            width: 100%;
            justify-content: center;
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .dashboard h2 {
            color: #e0e0e0;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .dashboard-subtitle {
            color: #a0a0a0;
            font-size: 1.1rem;
        }

        /* Data Sections */
        .data-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            color: #e0e0e0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .data-list {
            display: grid;
            gap: 1rem;
        }

        .data-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .data-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .data-item h4 {
            color: #e0e0e0;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }

        .data-item p {
            color: #a0a0a0;
            line-height: 1.6;
        }

        .data-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h3 {
            color: #e0e0e0;
            font-size: 1.5rem;
        }

        .close {
            background: none;
            border: none;
            color: #a0a0a0;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .close:hover {
            color: #e0e0e0;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #4a9eff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.info {
            background: #17a2b8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .header-actions {
                flex-wrap: wrap;
                justify-content: center;
            }

            .main-content {
                padding: 1rem;
            }

            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .data-actions {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-graduation-cap"></i> NoteGenie2</h1>
                <div class="header-actions">
                    <div class="user-actions">
                        <span id="userWelcome" class="user-welcome" style="display: none;">
                            Welcome, <span id="userName"></span>!
                        </span>
                        <button id="logoutBtn" class="btn btn-outline" style="display: none;">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Loading -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Loading...</p>
            </div>

            <!-- Auth Container -->
            <div id="authContainer" class="auth-container">
                <div class="auth-card">
                    <div class="auth-tabs">
                        <button class="auth-tab active" onclick="showAuthTab('login')">Login</button>
                        <button class="auth-tab" onclick="showAuthTab('signup')">Sign Up</button>
                    </div>

                    <!-- Login Form -->
                    <form id="loginForm" class="auth-form active">
                        <div class="form-group">
                            <label for="loginEmail">Email</label>
                            <input type="email" id="loginEmail" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-full">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </button>
                    </form>

                    <!-- Signup Form -->
                    <form id="signupForm" class="auth-form">
                        <div class="form-group">
                            <label for="signupEmail">Email</label>
                            <input type="email" id="signupEmail" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="signupPassword">Password (min 6 characters)</label>
                            <input type="password" id="signupPassword" class="form-control" minlength="6" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <input type="password" id="confirmPassword" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-full">
                            <i class="fas fa-user-plus"></i> Sign Up
                        </button>
                    </form>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboard" class="dashboard">
                <div class="dashboard-header">
                    <div>
                        <h2>My Study Materials</h2>
                        <p class="dashboard-subtitle">Manage your notes and flashcards</p>
                    </div>
                    <div>
                        <button class="btn" onclick="showAddModal('note')">
                            <i class="fas fa-plus"></i> Add Note
                        </button>
                        <button class="btn" onclick="showAddModal('flashcard')">
                            <i class="fas fa-plus"></i> Add Flashcard
                        </button>
                    </div>
                </div>

                <!-- Notes Section -->
                <div class="data-section">
                    <div class="section-header">
                        <h3 class="section-title">Notes</h3>
                    </div>
                    <div id="notesList" class="data-list">
                        <!-- Notes will be populated here -->
                    </div>
                </div>

                <!-- Flashcards Section -->
                <div class="data-section">
                    <div class="section-header">
                        <h3 class="section-title">Flashcards</h3>
                    </div>
                    <div id="flashcardsList" class="data-list">
                        <!-- Flashcards will be populated here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add Item</h3>
                <button class="close" onclick="hideAddModal()">&times;</button>
            </div>
            <form id="addForm">
                <div class="form-group">
                    <label for="itemTitle">Title</label>
                    <input type="text" id="itemTitle" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="itemContent">Content</label>
                    <textarea id="itemContent" class="form-control" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-full">
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>

    <script>
        // 🔥 Firebase Configuration - Your actual config
        const firebaseConfig = {
            apiKey: "AIzaSyDI8Iw-wC7rFoJ5lefaK9sPz3we05izqKM",
            authDomain: "flowgenie-ee967.firebaseapp.com",
            projectId: "flowgenie-ee967",
            storageBucket: "flowgenie-ee967.firebasestorage.app",
            messagingSenderId: "502614793101",
            appId: "1:502614793101:web:dae7c8fe22f55e2d0a3bc4"
        };

        // App ID for Firestore collections
        const APP_ID = "notegenie2";

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // App state
        let currentUser = null;
        let currentItemType = null;
        let editingItem = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Check if user is already logged in
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    showDashboard();
                    loadUserData();
                } else {
                    currentUser = null;
                    showAuth();
                }
            });

            // Bind event listeners
            bindEvents();
        }

        function bindEvents() {
            // Auth forms
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('signupForm').addEventListener('submit', handleSignup);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.getElementById('addForm').addEventListener('submit', handleAddItem);
        }

        // Auth functions
        async function handleLogin(e) {
            e.preventDefault();
            showLoading(true);

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                await auth.signInWithEmailAndPassword(email, password);
                showNotification('Login successful!', 'success');
            } catch (error) {
                showNotification('Login failed. Please check your email and password.', 'error');
                console.error('Login error:', error);
            } finally {
                showLoading(false);
            }
        }

        async function handleSignup(e) {
            e.preventDefault();
            showLoading(true);

            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (password !== confirmPassword) {
                showNotification('Passwords do not match.', 'error');
                showLoading(false);
                return;
            }

            if (password.length < 6) {
                showNotification('Password must be at least 6 characters.', 'error');
                showLoading(false);
                return;
            }

            try {
                await auth.createUserWithEmailAndPassword(email, password);
                showNotification('Account created successfully!', 'success');
            } catch (error) {
                showNotification('Sign up failed. Please try again.', 'error');
                console.error('Signup error:', error);
            } finally {
                showLoading(false);
            }
        }

        async function handleLogout() {
            try {
                await auth.signOut();
                showNotification('Logged out successfully.', 'info');
            } catch (error) {
                showNotification('Logout failed.', 'error');
                console.error('Logout error:', error);
            }
        }

        // UI functions
        function showAuthTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Update forms
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            document.getElementById(tab + 'Form').classList.add('active');
        }

        function showAuth() {
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('userWelcome').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
            document.getElementById('userWelcome').style.display = 'inline';
            document.getElementById('userName').textContent = currentUser.email;
            document.getElementById('logoutBtn').style.display = 'inline-block';
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('active', show);
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Data functions
        function loadUserData() {
            if (!currentUser) return;

            const userDataRef = db.collection('artifacts').doc(APP_ID).collection('users').doc(currentUser.uid).collection('user_data').doc('data');

            // Real-time listener
            userDataRef.onSnapshot((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    displayNotes(data.notes || []);
                    displayFlashcards(data.flashcards || []);
                } else {
                    // Create initial document
                    userDataRef.set({
                        notes: [],
                        flashcards: [],
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            }, (error) => {
                console.error('Error loading user data:', error);
                showNotification('Failed to load data.', 'error');
            });
        }

        function displayNotes(notes) {
            const container = document.getElementById('notesList');
            container.innerHTML = '';

            if (notes.length === 0) {
                container.innerHTML = '<p style="color: #a0a0a0; text-align: center; padding: 2rem;">No notes yet. Add your first note!</p>';
                return;
            }

            notes.forEach((note, index) => {
                const noteElement = createDataItem(note, 'note', index);
                container.appendChild(noteElement);
            });
        }

        function displayFlashcards(flashcards) {
            const container = document.getElementById('flashcardsList');
            container.innerHTML = '';

            if (flashcards.length === 0) {
                container.innerHTML = '<p style="color: #a0a0a0; text-align: center; padding: 2rem;">No flashcards yet. Add your first flashcard!</p>';
                return;
            }

            flashcards.forEach((flashcard, index) => {
                const flashcardElement = createDataItem(flashcard, 'flashcard', index);
                container.appendChild(flashcardElement);
            });
        }

        function createDataItem(item, type, index) {
            const div = document.createElement('div');
            div.className = 'data-item';
            div.innerHTML = `
                <h4>${escapeHtml(item.title)}</h4>
                <p>${escapeHtml(item.content)}</p>
                <div class="data-actions">
                    <button class="btn btn-sm" onclick="editItem('${type}', ${index})">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="deleteItem('${type}', ${index})">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            `;
            return div;
        }

        function showAddModal(type) {
            currentItemType = type;
            editingItem = null;
            document.getElementById('modalTitle').textContent = `Add ${type === 'note' ? 'Note' : 'Flashcard'}`;
            document.getElementById('itemTitle').value = '';
            document.getElementById('itemContent').value = '';
            document.getElementById('addModal').classList.add('active');
        }

        function hideAddModal() {
            document.getElementById('addModal').classList.remove('active');
            currentItemType = null;
            editingItem = null;
        }

        function editItem(type, index) {
            currentItemType = type;
            editingItem = index;
            
            // Get current data
            const userDataRef = db.collection('artifacts').doc(APP_ID).collection('users').doc(currentUser.uid).collection('user_data').doc('data');
            
            userDataRef.get().then((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    const items = data[type + 's'] || [];
                    const item = items[index];
                    
                    if (item) {
                        document.getElementById('modalTitle').textContent = `Edit ${type === 'note' ? 'Note' : 'Flashcard'}`;
                        document.getElementById('itemTitle').value = item.title;
                        document.getElementById('itemContent').value = item.content;
                        document.getElementById('addModal').classList.add('active');
                    }
                }
            });
        }

        async function handleAddItem(e) {
            e.preventDefault();
            showLoading(true);

            const title = document.getElementById('itemTitle').value;
            const content = document.getElementById('itemContent').value;

            try {
                const userDataRef = db.collection('artifacts').doc(APP_ID).collection('users').doc(currentUser.uid).collection('user_data').doc('data');
                
                await db.runTransaction(async (transaction) => {
                    const doc = await transaction.get(userDataRef);
                    const data = doc.exists ? doc.data() : { notes: [], flashcards: [] };
                    
                    const items = data[currentItemType + 's'] || [];
                    
                    if (editingItem !== null) {
                        // Edit existing item
                        items[editingItem] = { title, content };
                    } else {
                        // Add new item
                        items.push({ title, content });
                    }
                    
                    transaction.set(userDataRef, {
                        ...data,
                        [currentItemType + 's']: items,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                });

                showNotification(`${currentItemType === 'note' ? 'Note' : 'Flashcard'} ${editingItem !== null ? 'updated' : 'added'} successfully!`, 'success');
                hideAddModal();
            } catch (error) {
                showNotification(`Failed to ${editingItem !== null ? 'update' : 'add'} ${currentItemType}.`, 'error');
                console.error('Error saving item:', error);
            } finally {
                showLoading(false);
            }
        }

        async function deleteItem(type, index) {
            if (!confirm(`Are you sure you want to delete this ${type}?`)) return;

            showLoading(true);

            try {
                const userDataRef = db.collection('artifacts').doc(APP_ID).collection('users').doc(currentUser.uid).collection('user_data').doc('data');
                
                await db.runTransaction(async (transaction) => {
                    const doc = await transaction.get(userDataRef);
                    const data = doc.data();
                    const items = data[type + 's'] || [];
                    
                    items.splice(index, 1);
                    
                    transaction.set(userDataRef, {
                        ...data,
                        [type + 's']: items,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                });

                showNotification(`${type === 'note' ? 'Note' : 'Flashcard'} deleted successfully!`, 'success');
            } catch (error) {
                showNotification(`Failed to delete ${type}.`, 'error');
                console.error('Error deleting item:', error);
            } finally {
                showLoading(false);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
